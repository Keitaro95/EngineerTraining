
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>èˆªç©ºæ©Ÿæ©Ÿä½“æ•´å‚™ä½œæ¥­æŒ‡ç¤ºæ›¸æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ </title>

<!-- ============================================================
  CSS ã‚»ã‚¯ã‚·ãƒ§ãƒ³
  Streamlit ã® UI è¦ç´ ã‚’ vanilla CSS ã§å†ç¾ã—ã¦ã„ã‚‹ã€‚
  å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ:
    - CSSå¤‰æ•° (ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£) ã§è‰²ãƒ»ã‚µã‚¤ã‚ºã‚’ä¸€å…ƒç®¡ç†
    - Grid / Flexbox ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹ç¯‰
    - transition ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³æ¼”å‡º
    - @media ã§ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
============================================================ -->
<style>
/* â”€â”€ CSSå¤‰æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   :root ã«å®šç¾©ã™ã‚‹ã¨ã€ã©ã“ã‹ã‚‰ã§ã‚‚ var(--åå‰) ã§å‚ç…§ã§ãã‚‹ã€‚
   è‰²ã®å¤‰æ›´ã¯ã“ã“ã ã‘ã§æ¸ˆã‚€ã®ã§ä¿å®ˆæ€§ãŒé«˜ã„ã€‚           */
:root {
  --bg-primary: #0e1117;
  --bg-secondary: #1a1d24;
  --bg-sidebar: #14171f;
  --bg-card: #1e2230;
  --bg-input: #262b3d;
  --text-primary: #e6e8ef;
  --text-secondary: #9ca3b4;
  --text-muted: #6b7280;
  --accent-blue: #4a90d9;
  --accent-green: #2ecc71;
  --accent-red: #d32f2f;
  --accent-orange: #e67e22;
  --accent-yellow: #f1c40f;
  --border-color: #2d3348;
  --border-radius: 8px;
  --sidebar-width: 320px;
  --font-body: 'Segoe UI', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
  --font-mono: 'Cascadia Code', 'Source Code Pro', monospace;
  --transition-fast: 150ms ease;
  --transition-normal: 250ms ease;
}

/* â”€â”€ ãƒªã‚»ãƒƒãƒˆ & ãƒ™ãƒ¼ã‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚’çµ±ä¸€ã™ã‚‹ã€‚
   box-sizing: border-box ã¯ padding ã‚’ width ã«å«ã‚ã‚‹ã€‚ */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-body);
  background-color: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

/* â”€â”€ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Streamlit ã¯å·¦ã«ã‚µã‚¤ãƒ‰ãƒãƒ¼ã€å³ã«ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€‚
   CSS Grid ã§ 2 ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å®Ÿç¾ã™ã‚‹ã€‚         */
.app-layout {
  display: grid;
  grid-template-columns: var(--sidebar-width) 1fr;
  min-height: 100vh;
}

/* â”€â”€ ã‚µã‚¤ãƒ‰ãƒãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Streamlit ã® st.sidebar ã«ç›¸å½“ã€‚
   position: sticky ã§ç”»é¢å›ºå®šã€‚overflow-y: auto ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€‚ */
.sidebar {
  background-color: var(--bg-sidebar);
  border-right: 1px solid var(--border-color);
  padding: 1.5rem;
  position: sticky;
  top: 0;
  height: 100vh;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.sidebar-header {
  font-size: 1rem;
  font-weight: 700;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--border-color);
}

/* â”€â”€ ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main-content {
  padding: 2rem 3rem;
  max-width: 1200px;
}

/* â”€â”€ å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Streamlit ã®å„ UI ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«å¯¾å¿œã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã€‚    */

/* ãƒ˜ãƒƒãƒ€ãƒ¼ (st.markdown("## ...")) */
.page-title {
  font-size: 1.75rem;
  font-weight: 700;
  margin-bottom: 0.25rem;
}
.page-subtitle {
  color: var(--text-secondary);
  font-size: 0.95rem;
  margin-bottom: 1.5rem;
}

/* åŒºåˆ‡ã‚Šç·š (st.divider()) */
.divider {
  border: none;
  border-top: 1px solid var(--border-color);
  margin: 1.25rem 0;
}

/* ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼ (st.file_uploader) */
.file-upload-zone {
  border: 2px dashed var(--border-color);
  border-radius: var(--border-radius);
  padding: 1.25rem;
  text-align: center;
  cursor: pointer;
  transition: border-color var(--transition-normal), background var(--transition-normal);
  position: relative;
  margin-bottom: 0.75rem;
}
.file-upload-zone:hover {
  border-color: var(--accent-blue);
  background: rgba(74, 144, 217, 0.05);
}
.file-upload-zone.has-file {
  border-color: var(--accent-green);
  border-style: solid;
  background: rgba(46, 204, 113, 0.05);
}
.file-upload-zone input[type="file"] {
  /* input ã‚’é€æ˜ã«ã—ã¦ zone å…¨ä½“ã‚’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}
.file-upload-label {
  font-size: 0.85rem;
  color: var(--text-secondary);
  margin-bottom: 0.5rem;
  display: block;
}
.file-upload-icon {
  font-size: 1.5rem;
  margin-bottom: 0.25rem;
}
.file-name-display {
  font-size: 0.8rem;
  color: var(--accent-green);
  margin-top: 0.5rem;
  word-break: break-all;
}
.file-help {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-top: 0.25rem;
}

/* ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ (st.sidebar.error) */
.validation-error {
  background: rgba(211, 47, 47, 0.1);
  border-left: 3px solid var(--accent-red);
  color: #ef9a9a;
  padding: 0.5rem 0.75rem;
  border-radius: 0 var(--border-radius) var(--border-radius) 0;
  font-size: 0.8rem;
  margin-top: 0.25rem;
}

/* ãƒœã‚¿ãƒ³ (st.button) */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.6rem 1.25rem;
  border: none;
  border-radius: var(--border-radius);
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-fast);
  width: 100%;
  font-family: var(--font-body);
}
.btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}
/* type="primary" */
.btn-primary {
  background: var(--accent-blue);
  color: #fff;
}
.btn-primary:hover:not(:disabled) {
  background: #5a9ee0;
  transform: translateY(-1px);
}
/* type="secondary" */
.btn-secondary {
  background: var(--bg-input);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}
.btn-secondary:hover:not(:disabled) {
  background: var(--bg-card);
}
/* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã®ã‚¸ãƒ§ãƒ–ãƒœã‚¿ãƒ³ */
.btn-job.active {
  background: var(--accent-blue);
  color: #fff;
  border-color: var(--accent-blue);
}

/* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ (st.selectbox) */
.select-wrapper {
  position: relative;
}
.select-wrapper select {
  width: 100%;
  padding: 0.6rem 0.75rem;
  background: var(--bg-input);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  font-size: 0.9rem;
  font-family: var(--font-body);
  appearance: none;
  cursor: pointer;
}
.select-wrapper::after {
  content: 'â–¾';
  position: absolute;
  right: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  color: var(--text-muted);
}

/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç³» (st.success, st.error, st.info, st.warning) */
.msg {
  padding: 0.75rem 1rem;
  border-radius: var(--border-radius);
  font-size: 0.85rem;
  margin: 0.5rem 0;
}
.msg-success {
  background: rgba(46, 204, 113, 0.1);
  border-left: 4px solid var(--accent-green);
  color: #a3e4b8;
}
.msg-error {
  background: rgba(211, 47, 47, 0.1);
  border-left: 4px solid var(--accent-red);
  color: #ef9a9a;
}
.msg-info {
  background: rgba(74, 144, 217, 0.1);
  border-left: 4px solid var(--accent-blue);
  color: #90caf9;
}
.msg-warning {
  background: rgba(230, 126, 34, 0.1);
  border-left: 4px solid var(--accent-orange);
  color: #ffcc80;
}

/* ã‚¹ãƒ”ãƒŠãƒ¼ (st.spinner) */
.spinner-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 1rem;
}
.spinner-overlay.active {
  display: flex;
}
/* @keyframes ã§å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®šç¾© */
@keyframes spin {
  to { transform: rotate(360deg); }
}
.spinner-ring {
  width: 48px;
  height: 48px;
  border: 4px solid var(--border-color);
  border-top-color: var(--accent-blue);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
.spinner-text {
  color: var(--text-primary);
  font-size: 0.95rem;
}

/* â”€â”€ TOæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   st.markdown(to_info_html, unsafe_allow_html=True) ã«å¯¾å¿œã€‚
   CSS Grid ã§ 2Ã—2 ã®ã‚«ãƒ¼ãƒ‰é…ç½®ã€‚                     */
.to-info-section {
  margin-bottom: 1.5rem;
}
.to-info-title {
  font-size: 1.15rem;
  font-weight: 700;
  margin-bottom: 1rem;
}
.to-info-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}
.to-info-box {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  padding: 1rem;
}
.box-header {
  font-weight: 700;
  font-size: 0.95rem;
}
.box-content {
  background: var(--bg-input);
  padding: 0.75rem;
  border-radius: 4px;
  min-height: 60px;
  white-space: pre-wrap;
  word-wrap: break-word;
  margin-top: 0.5rem;
  font-size: 0.85rem;
  color: var(--text-secondary);
}

/* â”€â”€ çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.results-header {
  font-size: 1.3rem;
  font-weight: 700;
  margin-bottom: 1rem;
}
.results-header code {
  background: var(--bg-input);
  padding: 0.15rem 0.5rem;
  border-radius: 4px;
  font-family: var(--font-mono);
  font-size: 0.85em;
}

/* ã‚¸ãƒ§ãƒ–åãƒœã‚¿ãƒ³ç¾¤ (st.columns + st.button) */
.job-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}
.job-buttons .btn {
  width: auto;
  min-width: 140px;
  flex: 1;
  max-width: 220px;
}

/* ã‚¿ãƒ– (st.tabs) */
.tabs-container {
  margin-bottom: 1.5rem;
}
.tab-headers {
  display: flex;
  border-bottom: 2px solid var(--border-color);
  margin-bottom: 1rem;
}
.tab-header {
  padding: 0.6rem 1.25rem;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text-muted);
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
  transition: color var(--transition-fast), border-color var(--transition-fast);
  background: none;
  border-top: none;
  border-left: none;
  border-right: none;
  font-family: var(--font-body);
}
.tab-header:hover {
  color: var(--text-primary);
}
.tab-header.active {
  color: var(--accent-blue);
  border-bottom-color: var(--accent-blue);
}
.tab-panel {
  display: none;
  animation: fadeIn 0.2s ease;
}
.tab-panel.active {
  display: block;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(4px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ãƒ¡ãƒˆãƒªã‚¯ã‚¹ (st.metric) */
.metrics-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin: 1rem 0;
}
.metric-card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  padding: 1rem;
  text-align: center;
}
.metric-label {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin-bottom: 0.25rem;
}
.metric-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--accent-blue);
}

/* å€™è£œã‚«ãƒ¼ãƒ‰å†…ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
.candidate-detail {
  margin-bottom: 0.75rem;
}
.candidate-detail strong {
  color: var(--text-primary);
}
.candidate-detail .value {
  color: var(--text-secondary);
}

/* æ”¹è¨‚æ–‡æ›¸æ¡ˆ (èµ¤æ–‡å­—) */
.revision-draft-text {
  color: var(--accent-red) !important;
  font-weight: 500;
}

/* ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º (st.text) */
.plain-text {
  background: var(--bg-input);
  padding: 0.75rem;
  border-radius: 4px;
  font-family: var(--font-mono);
  font-size: 0.8rem;
  white-space: pre-wrap;
  word-wrap: break-word;
  color: var(--text-secondary);
  margin: 0.25rem 0 0.75rem;
}

/* æ³¨æ„äº‹é …ãƒªã‚¹ãƒˆ */
.notes-list {
  list-style: none;
  padding: 0;
}
.notes-list li::before {
  content: 'â€¢';
  color: var(--accent-blue);
  margin-right: 0.5rem;
}

/* Expander (st.expander) */
.expander {
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  margin-bottom: 0.5rem;
}
.expander-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.6rem 0.75rem;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-primary);
  background: var(--bg-card);
  border-radius: var(--border-radius);
  user-select: none;
}
.expander-header:hover {
  background: var(--bg-input);
}
.expander-arrow {
  transition: transform var(--transition-fast);
  font-size: 0.7rem;
}
.expander.open .expander-arrow {
  transform: rotate(90deg);
}
.expander-body {
  display: none;
  padding: 0.75rem;
  font-size: 0.8rem;
  border-top: 1px solid var(--border-color);
}
.expander.open .expander-body {
  display: block;
}

/* caption (st.caption) */
.caption {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin-bottom: 0.75rem;
}

/* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ« */
.section-title {
  font-size: 1.1rem;
  font-weight: 700;
  margin-bottom: 0.75rem;
}

/* â”€â”€ ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ç”»é¢å¹… 768px ä»¥ä¸‹ã§ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’ä¸Šã«ç•³ã‚€ã€‚         */
@media (max-width: 768px) {
  .app-layout {
    grid-template-columns: 1fr;
  }
  .sidebar {
    position: relative;
    height: auto;
    border-right: none;
    border-bottom: 1px solid var(--border-color);
  }
  .main-content {
    padding: 1.5rem;
  }
  .to-info-grid {
    grid-template-columns: 1fr;
  }
  .metrics-row {
    grid-template-columns: 1fr;
  }
  .job-buttons .btn {
    max-width: none;
  }
}
</style>
</head>

<body>

<!-- ============================================================
  HTML æ§‹é€ ã‚»ã‚¯ã‚·ãƒ§ãƒ³
  Streamlit ã®å„ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’æ„å‘³çš„ãª HTML è¦ç´ ã§å†ç¾ã€‚
  å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ:
    - ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ HTML (aside, main, section, article)
    - data-* å±æ€§ã§JSã‹ã‚‰å‚ç…§ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æŒãŸã›ã‚‹
    - id / class ã®å‘½åè¦å‰‡
============================================================ -->

<!-- ã‚¹ãƒ”ãƒŠãƒ¼ï¼ˆå…¨ç”»é¢ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰: st.spinner() ã«å¯¾å¿œ -->
<div class="spinner-overlay" id="spinner">
  <div class="spinner-ring"></div>
  <div class="spinner-text" id="spinnerText">å‡¦ç†ä¸­...</div>
</div>

<div class="app-layout">

  <!-- ======== ã‚µã‚¤ãƒ‰ãƒãƒ¼ ======== -->
  <aside class="sidebar">
    <div class="sidebar-header">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>

    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼ boxA: st.sidebar.file_uploader -->
    <div>
      <label class="file-upload-label">æ¯”è¼ƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆYSS æ¯”è¼ƒ~.xlsxï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
      <div class="file-upload-zone" id="diffZone">
        <div class="file-upload-icon">ğŸ“„</div>
        <div>ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯</div>
        <div class="file-help">.xlsx, .xls ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ</div>
        <div class="file-name-display" id="diffFileName"></div>
        <!-- 
          input[type="file"] ã® accept å±æ€§ã§å—ã‘ä»˜ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’æŒ‡å®šã€‚
          change ã‚¤ãƒ™ãƒ³ãƒˆã§ JS å´ã«ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’æ¸¡ã™ã€‚
        -->
        <input type="file" id="diffFile" accept=".xlsx,.xls">
      </div>
      <div id="diffErrors"></div>
    </div>

    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼ boxB -->
    <div>
      <label class="file-upload-label">Oãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆYSS O~.xlsxï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
      <div class="file-upload-zone" id="toserZone">
        <div class="file-upload-icon">ğŸ“„</div>
        <div>ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯</div>
        <div class="file-help">.xlsx, .xls ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ</div>
        <div class="file-name-display" id="toserFileName"></div>
        <input type="file" id="toserFile" accept=".xlsx,.xls">
      </div>
      <div id="toserErrors"></div>
    </div>

    <!-- æ¤œç´¢å®Ÿè¡Œãƒœã‚¿ãƒ³: st.sidebar.button("ğŸš€ æ¤œç´¢å®Ÿè¡Œ", type="primary") -->
    <button class="btn btn-primary" id="searchBtn" disabled>
      ğŸš€ æ¤œç´¢å®Ÿè¡Œ
    </button>
    <div id="searchStatus"></div>

    <hr class="divider">

    <!-- è¡¨ç¤ºè¨­å®š: st.sidebar.selectbox -->
    <div id="yssSelectSection" style="display:none;">
      <div class="sidebar-header">ğŸ”§ è¡¨ç¤ºè¨­å®š</div>
      <label class="file-upload-label">è¡¨ç¤ºã™ã‚‹ YSS ID ã‚’é¸æŠ</label>
      <div class="select-wrapper">
        <select id="yssSelect"></select>
      </div>
      <hr class="divider">
    </div>

    <!-- ãƒ†ã‚¹ãƒˆç”¨ãƒœã‚¿ãƒ³: st.sidebar.button("ğŸ“Š ã‚¹ã‚¿ãƒ–ãƒ‡ãƒ¼ã‚¿å–å¾—") -->
    <div>
      <div class="sidebar-header">ğŸ§ª ãƒ†ã‚¹ãƒˆç”¨</div>
      <button class="btn btn-secondary" id="stubBtn">
        ğŸ“Š ã‚¹ã‚¿ãƒ–ãƒ‡ãƒ¼ã‚¿å–å¾—
      </button>
    </div>

    <hr class="divider">

    <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ±: st.sidebar.expander -->
    <div id="debugSection" style="display:none;">
      <div class="sidebar-header">ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±</div>
      <div class="expander" id="expanderRaw">
        <div class="expander-header" onclick="toggleExpander('expanderRaw')">
          ğŸ“„ APIãƒ¬ã‚¹ãƒãƒ³ã‚¹JSONï¼ˆå…¨ä½“ï¼‰<span class="expander-arrow">â–¶</span>
        </div>
        <div class="expander-body">
          <pre id="debugRawJson" style="overflow:auto;max-height:300px;font-size:0.75rem;color:var(--text-secondary);"></pre>
        </div>
      </div>
      <div class="expander open" id="expanderExtracted">
        <div class="expander-header" onclick="toggleExpander('expanderExtracted')">
          ğŸ“Š æŠ½å‡ºçµæœï¼ˆè©³ç´°ï¼‰<span class="expander-arrow">â–¶</span>
        </div>
        <div class="expander-body">
          <div id="debugExtracted"></div>
        </div>
      </div>
    </div>
  </aside>

  <!-- ======== ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ ======== -->
  <main class="main-content">
    <!-- ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«: st.markdown("## ğŸ” ...") -->
    <h1 class="page-title">ğŸ” èˆªç©ºæ©Ÿæ©Ÿä½“æ•´å‚™ä½œæ¥­æŒ‡ç¤ºæ›¸æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ </h1>
    <p class="page-subtitle">YSSå·®åˆ†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€é–¢é€£ã™ã‚‹ä½œæ¥­æ‰‹é †æ›¸ã‚’æ¤œç´¢ã—ã¾ã™ã€‚</p>

    <!-- TOæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div id="toInfoSection" style="display:none;"></div>

    <!-- çµæœã‚¨ãƒªã‚¢ -->
    <div id="resultsArea">
      <!-- åˆæœŸçŠ¶æ…‹: st.info("ğŸ‘ˆ ...") -->
      <div class="msg msg-info">
        ğŸ‘ˆ ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ã€Œæ¤œç´¢å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
      </div>

      <!-- ä½¿ã„æ–¹: st.expander("ğŸ“– ä½¿ã„æ–¹") -->
      <div class="expander" id="expanderUsage">
        <div class="expander-header" onclick="toggleExpander('expanderUsage')">
          ğŸ“– ä½¿ã„æ–¹ <span class="expander-arrow">â–¶</span>
        </div>
        <div class="expander-body">
          <ol style="padding-left:1.25rem; color:var(--text-secondary); line-height:2;">
            <li><strong>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</strong>:
              boxA: ãƒ•ã‚¡ã‚¤ãƒ«åã«ã€Œæ¯”è¼ƒã€ã‚’å«ã‚€ .xlsx ãƒ•ã‚¡ã‚¤ãƒ« /
              boxB: ãƒ•ã‚¡ã‚¤ãƒ«åã«ã€ŒOã€ã‚’å«ã‚€ .xlsx ãƒ•ã‚¡ã‚¤ãƒ«</li>
            <li><strong>æ¤œç´¢å®Ÿè¡Œ</strong>: ä¸¡æ–¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒæƒã„ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é€šéå¾Œã«ã€ŒğŸš€ æ¤œç´¢å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            <li><strong>çµæœã‚’ç¢ºèª</strong>:
              è¤‡æ•°ã®çµæœã‚»ãƒƒãƒˆãŒã‚ã‚‹å ´åˆã¯ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§é¸æŠ /
              ã‚¸ãƒ§ãƒ–åã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¯èƒ½ /
              ã‚¹ã‚³ã‚¢é †ã«ã‚¿ãƒ–ã§è¡¨ç¤ºã•ã‚Œã¾ã™</li>
          </ol>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- ============================================================
  JavaScript ã‚»ã‚¯ã‚·ãƒ§ãƒ³
  Streamlit ã® session_state + ãƒ­ã‚¸ãƒƒã‚¯ + UIæ›´æ–°ã‚’ vanilla JS ã§å†ç¾ã€‚
  å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ:
    - DOM æ“ä½œ (getElementById, innerHTML, addEventListener)
    - ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° (change, click)
    - çŠ¶æ…‹ç®¡ç† (ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ session_state ã‚’æ¨¡å€£)
    - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«ã§å‹•çš„ HTML ç”Ÿæˆ
    - JSON ã®ãƒ‘ãƒ¼ã‚¹ã¨æ•´å½¢
============================================================ -->
<script>
// â”€â”€ çŠ¶æ…‹ç®¡ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Streamlit ã® st.session_state ã«å¯¾å¿œã™ã‚‹ã€‚
// ã‚¢ãƒ—ãƒªå…¨ä½“ã®çŠ¶æ…‹ã‚’ã“ã®1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ç®¡ç†ã™ã‚‹ã€‚
const state = {
  diffFile: null,        // boxA ãƒ•ã‚¡ã‚¤ãƒ«
  toserFile: null,       // boxB ãƒ•ã‚¡ã‚¤ãƒ«
  validDiff: false,      // boxA ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµæœ
  validToser: false,     // boxB ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµæœ
  apiResult: null,       // API ãƒ¬ã‚¹ãƒãƒ³ã‚¹å…¨ä½“
  allCandidates: null,   // æŠ½å‡ºã•ã‚ŒãŸå€™è£œ (Resultså‹)
  uiData: null,          // UI ç”¨ã«å¤‰æ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ (StreamlitUISchemaå‹)
  selectedYssId: null,   // é¸æŠä¸­ã® YSS_ID
  selectedJobName: null, // é¸æŠä¸­ã®ã‚¸ãƒ§ãƒ–å
  toNumber: 'æœªæ¤œå‡º',
  tripleSn: 'æœªæ¤œå‡º',
};

// â”€â”€ DOM è¦ç´ ã®å‚ç…§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// é »ç¹ã«ä½¿ã†è¦ç´ ã¯å¤‰æ•°ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãŠãã¨åŠ¹ç‡çš„ã€‚
const $diffFile     = document.getElementById('diffFile');
const $toserFile    = document.getElementById('toserFile');
const $diffZone     = document.getElementById('diffZone');
const $toserZone    = document.getElementById('toserZone');
const $diffFileName = document.getElementById('diffFileName');
const $toserFileName= document.getElementById('toserFileName');
const $diffErrors   = document.getElementById('diffErrors');
const $toserErrors  = document.getElementById('toserErrors');
const $searchBtn    = document.getElementById('searchBtn');
const $searchStatus = document.getElementById('searchStatus');
const $yssSelect    = document.getElementById('yssSelect');
const $yssSelectSec = document.getElementById('yssSelectSection');
const $resultsArea  = document.getElementById('resultsArea');
const $toInfoSection= document.getElementById('toInfoSection');
const $debugSection = document.getElementById('debugSection');
const $spinner      = document.getElementById('spinner');
const $spinnerText  = document.getElementById('spinnerText');

// â”€â”€ ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Streamlit å´ã®ãƒ•ã‚¡ã‚¤ãƒ«åãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãã®ã¾ã¾å†ç¾ã€‚
function validateDiffFile(file) {
  const errors = [];
  if (!file.name.includes('YSS')) {
    errors.push('âš ï¸ boxA: ãƒ•ã‚¡ã‚¤ãƒ«åã«ã€ŒYSSã€ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
  }
  if (!file.name.includes('æ¯”è¼ƒ')) {
    errors.push('âš ï¸ boxA: ãƒ•ã‚¡ã‚¤ãƒ«åã«ã€Œæ¯”è¼ƒã€ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
  }
  return errors;
}

function validateToserFile(file) {
  const errors = [];
  if (!file.name.includes('YSS')) {
    errors.push('âš ï¸ boxB: ãƒ•ã‚¡ã‚¤ãƒ«åã«ã€ŒYSSã€ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
  }
  if (!file.name.includes('O')) {
    errors.push('âš ï¸ boxB: ãƒ•ã‚¡ã‚¤ãƒ«åã«ã€ŒOã€ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
  }
  return errors;
}

// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹æ±ç”¨é–¢æ•°
function showErrors(container, errors) {
  container.innerHTML = errors
    .map(e => `<div class="validation-error">${e}</div>`)
    .join('');
}

// æ¤œç´¢ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’æ›´æ–°
function updateSearchButton() {
  const canSearch = state.diffFile && state.toserFile && state.validDiff && state.validToser;
  $searchBtn.disabled = !canSearch;
}

// â”€â”€ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¤ãƒ™ãƒ³ãƒˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// input[type="file"] ã® change ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–ã™ã‚‹ã€‚
// Streamlit ã§ã¯ st.file_uploader ã®æˆ»ã‚Šå€¤ãŒè‡ªå‹•ã§æ›´æ–°ã•ã‚Œã‚‹éƒ¨åˆ†ã€‚
$diffFile.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;

  state.diffFile = file;
  $diffFileName.textContent = `ğŸ“ ${file.name}`;
  $diffZone.classList.add('has-file');

  const errors = validateDiffFile(file);
  state.validDiff = errors.length === 0;
  showErrors($diffErrors, errors);
  updateSearchButton();
});

$toserFile.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;

  state.toserFile = file;
  $toserFileName.textContent = `ğŸ“ ${file.name}`;
  $toserZone.classList.add('has-file');

  const errors = validateToserFile(file);
  state.validToser = errors.length === 0;
  showErrors($toserErrors, errors);
  updateSearchButton();
});

// â”€â”€ Expander ã®é–‹é–‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// st.expander ã«å¯¾å¿œã€‚class ã® toggle ã§è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã€‚
function toggleExpander(id) {
  document.getElementById(id).classList.toggle('open');
}

// â”€â”€ ã‚¹ãƒ”ãƒŠãƒ¼åˆ¶å¾¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showSpinner(text) {
  $spinnerText.textContent = text;
  $spinner.classList.add('active');
}
function hideSpinner() {
  $spinner.classList.remove('active');
}

// â”€â”€ API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ã®å€™è£œæŠ½å‡º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Python ã® extract_all_candidates() ã‚’ JS ã«ç§»æ¤ã€‚
function extractAllCandidates(apiResponse) {
  const results = {};
  if (!apiResponse.data) return results;
  if (apiResponse.data.status !== 'succeeded') return results;

  const outputs = apiResponse.data.outputs || {};
  const textList = outputs.text || [];

  if (!Array.isArray(textList)) return results;

  // textList ã®å„è¦ç´ ã¯ {"YSS_ID:1": [...], ...} ã®ã‚ˆã†ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
  for (const item of textList) {
    if (typeof item === 'object' && item !== null) {
      for (const [key, value] of Object.entries(item)) {
        if (key.startsWith('YSS_ID')) {
          if (Array.isArray(value)) {
            results[key] = value;
          } else if (typeof value === 'string') {
            const candidates = parseTextOutput(value);
            if (candidates.length > 0) {
              results[key] = candidates;
            }
          }
        }
      }
    }
  }
  return results;
}

// Python ã® parse_text_output() ã‚’ JS ã«ç§»æ¤
function parseTextOutput(textContent) {
  let jsonString = textContent.trim();

  // ```json ... ``` ã‚’é™¤å»
  if (jsonString.startsWith('```') && jsonString.endsWith('```')) {
    const lines = jsonString.split('\n');
    jsonString = lines.slice(1, -1).join('\n');
  }
  if (jsonString.toLowerCase().startsWith('json')) {
    jsonString = jsonString.slice(4).trimStart();
  }

  try {
    const parsed = JSON.parse(jsonString);
    if (Array.isArray(parsed)) return parsed;
    if (typeof parsed === 'object') return [parsed];
    return [];
  } catch {
    return [];
  }
}

// â”€â”€ UI ã‚¹ã‚­ãƒ¼ãƒã¸ã®å¤‰æ› â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Python ã® transform_to_ui_schema() ã‚’ JS ã«ç§»æ¤ã€‚
function transformToUiSchema(results) {
  const yssGroups = [];

  for (const [yssId, candidates] of Object.entries(results)) {
    // job_name ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    const jobDict = {};
    for (const c of candidates) {
      const jobName = c.job_name || 'Unknown';
      if (!jobDict[jobName]) jobDict[jobName] = [];
      jobDict[jobName].push(c);
    }

    // job_name ã‚’ã‚½ãƒ¼ãƒˆã—ã€å„ã‚°ãƒ«ãƒ¼ãƒ—å†…ã‚’ rank ã§ã‚½ãƒ¼ãƒˆ
    const jobGroups = Object.keys(jobDict).sort().map(jobName => {
      const sorted = jobDict[jobName].sort((a, b) => {
        const ra = parseInt(a.rank) || 999;
        const rb = parseInt(b.rank) || 999;
        return ra - rb;
      });
      return { job_name: jobName, candidates: sorted };
    });

    yssGroups.push({
      yss_id: yssId,
      yss_id_display: yssId.replace('YSS_ID:', 'YSS ID '),
      job_groups: jobGroups,
    });
  }
  return { yss_groups: yssGroups };
}

// â”€â”€ YSS ID ã‚»ãƒ¬ã‚¯ã‚¿ã®æ›´æ–° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// st.sidebar.selectbox ã«å¯¾å¿œã€‚
// option è¦ç´ ã‚’å‹•çš„ã«ç”Ÿæˆã™ã‚‹ã€‚
function updateYssSelector() {
  const groups = state.uiData?.yss_groups || [];
  if (groups.length === 0) {
    $yssSelectSec.style.display = 'none';
    return;
  }

  $yssSelectSec.style.display = 'block';
  $yssSelect.innerHTML = groups
    .map(g => `<option value="${g.yss_id}">${g.yss_id_display}</option>`)
    .join('');

  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠ
  if (!state.selectedYssId || !groups.find(g => g.yss_id === state.selectedYssId)) {
    state.selectedYssId = groups[0].yss_id;
  }
  $yssSelect.value = state.selectedYssId;
}

$yssSelect.addEventListener('change', () => {
  state.selectedYssId = $yssSelect.value;
  state.selectedJobName = null; // ã‚¸ãƒ§ãƒ–é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
  renderResults();
});

// â”€â”€ ã‚¸ãƒ§ãƒ–åãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectJob(jobName) {
  state.selectedJobName = jobName;
  renderResults();
}

// â”€â”€ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// st.tabs ã«å¯¾å¿œã€‚
// data-tab å±æ€§ã§ã‚¿ãƒ–ã¨ãƒ‘ãƒãƒ«ã‚’ç´ã¥ã‘ã‚‹ã€‚
function switchTab(tabGroupId, tabIndex) {
  const group = document.getElementById(tabGroupId);
  if (!group) return;

  // å…¨ãƒ˜ãƒƒãƒ€ãƒ¼/ãƒ‘ãƒãƒ«ã‹ã‚‰ active ã‚’å¤–ã™
  group.querySelectorAll('.tab-header').forEach(h => h.classList.remove('active'));
  group.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

  // æŒ‡å®šã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã« active ã‚’ä»˜ã‘ã‚‹
  const headers = group.querySelectorAll('.tab-header');
  const panels  = group.querySelectorAll('.tab-panel');
  if (headers[tabIndex]) headers[tabIndex].classList.add('active');
  if (panels[tabIndex])  panels[tabIndex].classList.add('active');
}

// â”€â”€ æ¤œç´¢çµæœã®æç”» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Streamlit ã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æç”»ãƒ­ã‚¸ãƒƒã‚¯å…¨ä½“ã«å¯¾å¿œã€‚
// innerHTML ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«ã§ HTML ã‚’çµ„ã¿ç«‹ã¦ã¦æµã—è¾¼ã‚€ã€‚
function renderResults() {
  if (!state.uiData || !state.uiData.yss_groups.length) {
    $resultsArea.innerHTML = `<div class="msg msg-info">æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
    $toInfoSection.style.display = 'none';
    return;
  }

  const groups = state.uiData.yss_groups;
  const selectedGroup = groups.find(g => g.yss_id === state.selectedYssId);
  if (!selectedGroup) {
    $resultsArea.innerHTML = `<div class="msg msg-warning">YSS_ID ã®ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚</div>`;
    return;
  }

  // TO æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³
  renderToInfo();

  const jobGroups = selectedGroup.job_groups || [];
  if (jobGroups.length === 0) {
    $resultsArea.innerHTML = `
      <hr class="divider">
      <div class="results-header">ğŸ“Š æ¤œç´¢çµæœ: <code>${state.uploadedFilename || ''}</code></div>
      <div class="msg msg-info">å¯¾è±¡ã¨ãªã‚‹ã‚¸ãƒ§ãƒ–åãƒ•ã‚¡ã‚¤ãƒ«(.xlsx)ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
    `;
    return;
  }

  // ã‚¸ãƒ§ãƒ–åã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠ
  if (!state.selectedJobName || !jobGroups.find(jg => jg.job_name === state.selectedJobName)) {
    state.selectedJobName = jobGroups[0].job_name;
  }

  const selectedJob = jobGroups.find(jg => jg.job_name === state.selectedJobName);
  const candidates = selectedJob ? selectedJob.candidates : [];
  const numToShow = Math.min(candidates.length, 3);

  // ã‚¸ãƒ§ãƒ–ãƒœã‚¿ãƒ³ HTML
  const jobButtonsHtml = jobGroups.map((jg, i) => {
    const isActive = jg.job_name === state.selectedJobName;
    const label = (jg.job_name && jg.job_name.trim())
      ? jg.job_name.trim()
      : '(å¯¾è±¡ã¨ãªã‚‹ã‚¸ãƒ§ãƒ–å.xlsxãƒ•ã‚¡ã‚¤ãƒ«ãªã—)';
    return `<button class="btn btn-secondary btn-job ${isActive ? 'active' : ''}"
                    onclick="selectJob('${escapeHtml(jg.job_name)}')">${escapeHtml(label)}</button>`;
  }).join('');

  // ã‚¿ãƒ–ãƒ˜ãƒƒãƒ€ãƒ¼ + ãƒ‘ãƒãƒ« HTML
  let tabsHtml = '';
  if (candidates.length > 0) {
    const tabHeaders = candidates.slice(0, numToShow).map((c, i) => {
      const rank = c.rank != null ? parseInt(c.rank) || '?' : '?';
      return `<button class="tab-header ${i === 0 ? 'active' : ''}"
                      onclick="switchTab('rankTabs', ${i})">ã‚¹ã‚³ã‚¢${rank}ä½</button>`;
    }).join('');

    const tabPanels = candidates.slice(0, numToShow).map((c, i) => {
      return `<div class="tab-panel ${i === 0 ? 'active' : ''}">
        ${renderCandidate(c)}
      </div>`;
    }).join('');

    tabsHtml = `
      <div class="caption">å€™è£œæ•°: ${candidates.length}ä»¶ (ä¸Šä½${numToShow}ä»¶ã‚’è¡¨ç¤º)</div>
      <div class="tabs-container" id="rankTabs">
        <div class="tab-headers">${tabHeaders}</div>
        ${tabPanels}
      </div>`;
  } else {
    tabsHtml = `<div class="msg msg-info">ã“ã®ã‚¸ãƒ§ãƒ–åã«ã¯å€™è£œãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
  }

  $resultsArea.innerHTML = `
    <hr class="divider">
    <div class="results-header">ğŸ“Š æ¤œç´¢çµæœ: <code>${escapeHtml(state.uploadedFilename || '')}</code></div>
    <h2 style="margin-bottom:1rem;">ã‚¸ãƒ§ãƒ–æ¤œç´¢çµæœ (${escapeHtml(selectedGroup.yss_id_display)})</h2>
    <div class="section-title">ã‚¸ãƒ§ãƒ–å</div>
    <div class="job-buttons">${jobButtonsHtml}</div>
    <div class="section-title">ã‚¹ã‚³ã‚¢é †ä½</div>
    ${tabsHtml}
  `;
}

// â”€â”€ 1 ä»¶ã®å€™è£œã‚’æç”» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// å„ st.tabs å†…ã®å€™è£œè©³ç´°è¡¨ç¤ºã«å¯¾å¿œã€‚
function renderCandidate(c) {
  // ä½œæ¥­æ‰‹é †
  const matchedText = c.matched_text && String(c.matched_text).trim();
  const matchedHtml = matchedText
    ? `<div class="candidate-detail"><strong>ä½œæ¥­æ‰‹é †:</strong></div><div class="plain-text">${escapeHtml(matchedText)}</div>`
    : `<div class="msg msg-info">ä½œæ¥­æ‰‹é †ã®æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“</div>`;

  // ã‚³ãƒ¡ãƒ³ãƒˆ
  const comment = c.comment && String(c.comment).trim();
  const commentHtml = comment
    ? `<div class="candidate-detail"><strong>ã‚³ãƒ¡ãƒ³ãƒˆ:</strong></div><div class="msg msg-info">${escapeHtml(comment)}</div>`
    : `<div class="msg msg-info">ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</div>`;

  // æ”¹è¨‚æ–‡æ›¸æ¡ˆ
  const revDraft = c.revision_draft && String(c.revision_draft).trim();
  const revDraftHtml = revDraft
    ? `<div class="candidate-detail"><strong>æ”¹è¨‚æ–‡æ›¸æ¡ˆ:</strong></div><p class="revision-draft-text">${escapeHtml(revDraft)}</p>`
    : `<div class="candidate-detail"><strong>æ”¹è¨‚æ–‡æ›¸æ¡ˆ:</strong></div><div class="msg msg-info">æ”¹è¨‚æ–‡æ›¸æ¡ˆãŒã‚ã‚Šã¾ã›ã‚“</div>`;

  // æ³¨æ„äº‹é …
  const notes = (c.revision_notes || []).filter(n => n && String(n).trim());
  const notesHtml = notes.length > 0
    ? `<div class="candidate-detail"><strong>æ³¨æ„äº‹é …:</strong></div>
       <ul class="notes-list">${notes.map(n => `<li>${escapeHtml(String(n).trim())}</li>`).join('')}</ul>`
    : `<div class="candidate-detail"><strong>æ³¨æ„äº‹é …:</strong></div><div class="msg msg-info">æ³¨æ„äº‹é …ã¯ã‚ã‚Šã¾ã›ã‚“</div>`;

  // ã‚¹ã‚³ã‚¢è¡¨ç¤º
  const score     = Number(c.score || 0).toFixed(2);
  const proximity = Number(c.proximity || 0).toFixed(2);
  const llmScore  = Number(c.llm_score || 0).toFixed(1);

  return `
    <h4 style="margin-bottom:0.75rem;">è©³ç´°æƒ…å ±</h4>
    <div class="candidate-detail"><strong>ã‚¸ãƒ§ãƒ–å:</strong> <span class="value">${escapeHtml(c.job_name || 'N/A')}</span></div>
    <div class="candidate-detail"><strong>é …ç•ª:</strong> <span class="value">${escapeHtml(String(c.item_no ?? 'N/A'))}</span></div>
    ${matchedHtml}
    <div class="candidate-detail"><strong>äº‹å®Ÿä¸€è‡´:</strong> <span class="value">${escapeHtml(String(c.fact_match ?? 'N/A'))}</span></div>
    <div class="metrics-row">
      <div class="metric-card">
        <div class="metric-label">ç·åˆã‚¹ã‚³ã‚¢</div>
        <div class="metric-value">${score}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">è¿‘æ¥åº¦</div>
        <div class="metric-value">${proximity}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">LLMã‚¹ã‚³ã‚¢</div>
        <div class="metric-value">${llmScore}</div>
      </div>
    </div>
    ${commentHtml}
    <hr class="divider">
    ${revDraftHtml}
    ${notesHtml}
  `;
}

// â”€â”€ TO æƒ…å ±ã®æç”» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderToInfo() {
  $toInfoSection.style.display = 'block';
  $toInfoSection.innerHTML = `
    <div class="to-info-section">
      <div class="to-info-title">TOæƒ…å ±</div>
      <div class="to-info-grid">
        <div class="to-info-box">
          <div class="box-header">TOãƒŠãƒ³ãƒãƒ¼ï¼š${escapeHtml(state.toNumber)}</div>
        </div>
        <div class="to-info-box">
          <div class="box-header">ãƒˆãƒªãƒ—ãƒ«SNï¼š${escapeHtml(state.tripleSn)}</div>
        </div>
        <div class="to-info-box">
          <div class="box-header">å¤‰æ›´å‰</div>
          <div class="box-content">${escapeHtml(state.beforeText || 'ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰')}</div>
        </div>
        <div class="to-info-box">
          <div class="box-header">å¤‰æ›´å¾Œ</div>
          <div class="box-content">${escapeHtml(state.afterText || 'ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰')}</div>
        </div>
      </div>
    </div>`;
}

// â”€â”€ ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®æ›´æ–° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateDebug() {
  $debugSection.style.display = 'block';
  document.getElementById('debugRawJson').textContent =
    JSON.stringify(state.apiResult, null, 2);

  const $extracted = document.getElementById('debugExtracted');
  if (state.allCandidates && Object.keys(state.allCandidates).length > 0) {
    let html = `<div class="msg msg-success">âœ… æŠ½å‡ºã•ã‚ŒãŸ YSS_ID æ•°: ${Object.keys(state.allCandidates).length}</div>`;
    for (const [yssId, candidates] of Object.entries(state.allCandidates)) {
      html += `<div style="margin:0.25rem 0;"><strong>${yssId}</strong>: ${candidates.length}ä»¶</div>`;
      candidates.slice(0, 3).forEach((c, i) => {
        html += `<div style="color:var(--text-muted);font-size:0.75rem;margin-left:0.5rem;">
          [${i}] ${c.job_name || 'ä¸æ˜'}, rank=${c.rank ?? 'ãªã—'} (${typeof c.rank})</div>`;
      });
    }
    $extracted.innerHTML = html;
  } else {
    $extracted.innerHTML = `<div class="msg msg-error">âŒ å€™è£œãŒæŠ½å‡ºã§ãã¾ã›ã‚“ã§ã—ãŸ</div>`;
  }
}

// â”€â”€ HTML ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”±æ¥ã®æ–‡å­—åˆ—ã‚’ innerHTML ã«å…¥ã‚Œã‚‹éš›ã€XSS ã‚’é˜²ãã€‚
function escapeHtml(str) {
  if (str == null) return '';
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}

// â”€â”€ æ¤œç´¢å®Ÿè¡Œãƒœã‚¿ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// æœ¬æ¥ã¯ Dify API ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ãŒã€
// ã“ã“ã§ã¯ãƒ‡ãƒ¢ã¨ã—ã¦ã‚¹ã‚¿ãƒ–ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨åŒç­‰ã®æµã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã€‚
$searchBtn.addEventListener('click', async () => {
  // æ³¨æ„: å®Ÿé‹ç”¨ã§ã¯ fetch() ã§ Dify API ã‚’å©ãã€‚
  // ã“ã“ã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã“ã¨ã®ç¢ºèªãƒ‡ãƒ¢ã€‚
  showSpinner('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...');

  // å®Ÿéš›ã® API å‘¼ã³å‡ºã—ã®æ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã§å­¦ç¿’ç”¨ã«æ®‹ã™ï¼‰:
  /*
  const formData = new FormData();
  formData.append('file', state.diffFile);
  formData.append('user', 'demo-user');
  
  const uploadRes = await fetch(`${BASE_URL}/v1/files/upload`, {
    method: 'POST',
    headers: { 'Authorization': `Bearer ${API_KEY}` },
    body: formData
  });
  const uploadJson = await uploadRes.json();
  const fileId = uploadJson.id;
  
  const workflowRes = await fetch(`${BASE_URL}/v1/workflows/run`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      inputs: { yss_diff_file: { type: 'document', transfer_method: 'local_file', upload_file_id: fileId } },
      response_mode: 'blocking',
      user: 'demo-user'
    })
  });
  const result = await workflowRes.json();
  */

  // ãƒ‡ãƒ¢: 2ç§’å¾…ã£ã¦ã‚¹ã‚¿ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
  await new Promise(r => setTimeout(r, 2000));
  $spinnerText.textContent = 'ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œä¸­...ï¼ˆæœ€å¤§3åˆ†ç¨‹åº¦ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰';
  await new Promise(r => setTimeout(r, 1000));

  // ã‚¹ã‚¿ãƒ–ãƒ‡ãƒ¼ã‚¿ã§çµæœã‚’è¡¨ç¤º
  loadStubData();
  hideSpinner();
  $searchStatus.innerHTML = `<div class="msg msg-success">âœ… ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Œäº†ï¼ï¼ˆãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ï¼‰</div>`;
});

// â”€â”€ ã‚¹ã‚¿ãƒ–ãƒ‡ãƒ¼ã‚¿å–å¾— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ãƒ†ã‚¹ãƒˆç”¨ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã€‚
// æœ¬æ¥ã¯ response-example.json ã‹ã‚‰èª­ã¿è¾¼ã‚€ã€‚
document.getElementById('stubBtn').addEventListener('click', () => {
  loadStubData();
});

function loadStubData() {
  // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆresponse-example.json ã®æ¨¡æ“¬ï¼‰
  const stubData = {
    text: [
      {
        "YSS_ID:1": [
          {
            job_name: "O20-1.xlsx",
            item_no: "3.A.(1)",
            rank: 1,
            score: 4.85,
            proximity: 0.92,
            llm_score: 9.5,
            matched_text: "ã‚¨ãƒ³ã‚¸ãƒ³ã‚«ã‚¦ãƒªãƒ³ã‚°å–ã‚Šå¤–ã—æ‰‹é †:\n1. ã‚«ã‚¦ãƒ«ãƒ•ã‚¡ã‚¹ãƒŠãƒ¼ã‚’å…¨æ•°è§£é™¤\n2. æ²¹åœ§ãƒ©ã‚¤ãƒ³ã®æ¥ç¶šã‚’ç¢ºèª\n3. ã‚«ã‚¦ãƒªãƒ³ã‚°ã‚’å‰æ–¹ã«ã‚¹ãƒ©ã‚¤ãƒ‰ã•ã›ã¦å–ã‚Šå¤–ã™",
            fact_match: "ä¸€è‡´",
            comment: "YSSå¤‰æ›´å†…å®¹ã¨é«˜ã„é–¢é€£æ€§ãŒã‚ã‚Šã¾ã™ã€‚æ‰‹é †3ã®å–ã‚Šå¤–ã—æ–¹å‘ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚",
            revision_draft: "ã‚¨ãƒ³ã‚¸ãƒ³ã‚«ã‚¦ãƒªãƒ³ã‚°å–ã‚Šå¤–ã—æ™‚ã€æ²¹åœ§ãƒ©ã‚¤ãƒ³ä¿è­·ã‚«ãƒãƒ¼ã®è£…ç€ã‚’è¿½åŠ ï¼ˆRev.Cé©ç”¨ï¼‰",
            revision_notes: ["æ²¹åœ§ãƒ©ã‚¤ãƒ³æå‚·é˜²æ­¢ã®ãŸã‚ä¿è­·ã‚«ãƒãƒ¼å¿…é ˆ", "æ”¹è¨‚å±¥æ­´ã‚’Rev.Cã¨ã—ã¦è¨˜éŒ²ã™ã‚‹ã“ã¨"]
          },
          {
            job_name: "O20-1.xlsx",
            item_no: "3.A.(2)",
            rank: 2,
            score: 3.72,
            proximity: 0.85,
            llm_score: 8.0,
            matched_text: "ã‚«ã‚¦ãƒªãƒ³ã‚°å†å–ã‚Šä»˜ã‘æ‰‹é †:\n1. ã‚¬ã‚¹ã‚±ãƒƒãƒˆã®çŠ¶æ…‹ã‚’ç¢ºèª\n2. ä½ç½®åˆã‚ã›ãƒ”ãƒ³ã«æ²¿ã£ã¦ã‚»ãƒƒãƒˆ\n3. ãƒ•ã‚¡ã‚¹ãƒŠãƒ¼ã‚’è¦å®šãƒˆãƒ«ã‚¯ã§ç· çµ",
            fact_match: "éƒ¨åˆ†ä¸€è‡´",
            comment: "é–¢é€£ã™ã‚‹é€†æ‰‹é †ã§ã™ã€‚ã‚¬ã‚¹ã‚±ãƒƒãƒˆäº¤æ›åŸºæº–ã®ç¢ºèªã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚",
            revision_draft: "",
            revision_notes: []
          },
          {
            job_name: "O20-1.xlsx",
            item_no: "3.B.(1)",
            rank: 3,
            score: 2.10,
            proximity: 0.61,
            llm_score: 6.5,
            matched_text: "ã‚¨ãƒ³ã‚¸ãƒ³ãƒã‚¦ãƒ³ãƒˆç‚¹æ¤œæ‰‹é †",
            fact_match: "ä¸ä¸€è‡´",
            comment: "é–“æ¥çš„ãªé–¢é€£ã®ã¿ã€‚",
            revision_draft: "",
            revision_notes: []
          },
          {
            job_name: "O25-3.xlsx",
            item_no: "5.C.(1)",
            rank: 1,
            score: 4.50,
            proximity: 0.90,
            llm_score: 9.0,
            matched_text: "ç¿¼ç«¯ç¯äº¤æ›æ‰‹é †:\n1. ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã‚’OFFã«ã™ã‚‹\n2. ãƒ¬ãƒ³ã‚ºã‚«ãƒãƒ¼ã‚’å–ã‚Šå¤–ã™\n3. ãƒ©ãƒ³ãƒ—ãƒ¦ãƒ‹ãƒƒãƒˆã‚’äº¤æ›\n4. ç‚¹ç¯è©¦é¨“ã‚’å®Ÿæ–½",
            fact_match: "ä¸€è‡´",
            comment: "LEDåŒ–ã«ä¼´ã†æ‰‹é †å¤‰æ›´ãŒå¿…è¦ã§ã™ã€‚",
            revision_draft: "ãƒ©ãƒ³ãƒ—ãƒ¦ãƒ‹ãƒƒãƒˆã‚’LEDã‚¿ã‚¤ãƒ—ï¼ˆP/N: LED-2847ï¼‰ã«å¤‰æ›´ã€‚é…ç·šã‚¢ãƒ€ãƒ—ã‚¿ï¼ˆP/N: ADP-110ï¼‰ã®è¿½åŠ è£…ç€ãŒå¿…è¦ã€‚",
            revision_notes: ["å¾“æ¥å‹ã¨ã®äº’æ›æ€§ãªã—", "ç‚¹ç¯è©¦é¨“æ™‚é–“ã‚’30ç§’ã‹ã‚‰60ç§’ã«å»¶é•·"]
          }
        ]
      },
      {
        "YSS_ID:2": [
          {
            job_name: "O30-2.xlsx",
            item_no: "2.D.(1)",
            rank: 1,
            score: 4.20,
            proximity: 0.88,
            llm_score: 8.5,
            matched_text: "ç‡ƒæ–™ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼äº¤æ›æ‰‹é †:\n1. ç‡ƒæ–™é®æ–­ãƒãƒ«ãƒ–ã‚’é–‰æ­¢\n2. æ®‹åœ§ã‚’è§£æ”¾\n3. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã‚’äº¤æ›\n4. ãƒãƒ«ãƒ–ã‚’é–‹æ”¾ã—æ¼ã‚Œç¢ºèª",
            fact_match: "ä¸€è‡´",
            comment: "ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‹ç•ªã®å¤‰æ›´ã«å¯¾å¿œã™ã‚‹æ”¹è¨‚ãŒå¿…è¦ã§ã™ã€‚",
            revision_draft: "ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆå‹ç•ªã‚’ FE-3300A ã‹ã‚‰ FE-3300B ã«å¤‰æ›´ã€‚å–ä»˜æ–¹å‘çŸ¢å°ã®ç¢ºèªã‚’è¿½åŠ ã€‚",
            revision_notes: ["æ—§å‹ç•ª FE-3300A ã¯å»ƒç•ªäºˆå®š", "Oãƒªãƒ³ã‚°ã®åŒæ™‚äº¤æ›ã‚’æ¨å¥¨"]
          }
        ]
      },
      {
        "YSS_ID:3": [
          {
            job_name: "",
            item_no: "-",
            rank: 1,
            score: 0,
            proximity: 0,
            llm_score: 0,
            matched_text: "",
            fact_match: "N/A",
            comment: "å¯¾è±¡ã¨ãªã‚‹ã‚¸ãƒ§ãƒ–å.xlsxãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚",
            revision_draft: "",
            revision_notes: []
          }
        ]
      }
    ]
  };

  const mockApiResponse = {
    data: {
      status: 'succeeded',
      outputs: stubData
    }
  };

  // çŠ¶æ…‹ã‚’æ›´æ–°
  state.apiResult = mockApiResponse;
  state.allCandidates = extractAllCandidates(mockApiResponse);
  state.uiData = transformToUiSchema(state.allCandidates);
  state.uploadedFilename = 'ã‚¹ã‚¿ãƒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰';
  state.selectedYssId = null;
  state.selectedJobName = null;

  // ã‚µãƒ³ãƒ—ãƒ« TO æƒ…å ±
  state.toNumber = '1F-16C-2-70JG-00-1';
  state.tripleSn = '27-71-16';
  state.beforeText = 'ã‚«ã‚¦ãƒªãƒ³ã‚°å–ã‚Šå¤–ã—æ™‚ã€ä¿è­·ã‚«ãƒãƒ¼ä¸è¦';
  state.afterText = 'ã‚«ã‚¦ãƒªãƒ³ã‚°å–ã‚Šå¤–ã—æ™‚ã€æ²¹åœ§ãƒ©ã‚¤ãƒ³ä¿è­·ã‚«ãƒãƒ¼ã‚’è£…ç€ã™ã‚‹ã“ã¨ï¼ˆRev.Cï¼‰';

  // UI æ›´æ–°
  updateYssSelector();
  state.selectedYssId = state.uiData.yss_groups[0]?.yss_id;
  if ($yssSelect.value !== state.selectedYssId) {
    $yssSelect.value = state.selectedYssId;
  }
  renderResults();
  updateDebug();
}
</script>

</body>
</html>
